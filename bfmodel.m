function [flow_eachvessel,flow,pressure]=bfmodel(sim_radii);
% Mathematical model of whole-brain CBF of zebrafish larva;
% sim_radii:t*vesselnum
% sim_radii=repmat(vessel_radii,[length(t),1]);
t=1:1:size(sim_radii,1);
vesselnum=size(sim_radii,2);
sstress0=1.0;
or_in = [1,2,196,206];
or_out = [190,194,195,213,236,237,260,287,312,345,346,349];

% Geometric paramters of whole-brain vasculature of the larva used for establishing the CBF model;
vasculature=[[1,0,166.060000000000,340.570000000000,246,16,179.980000000000,419.620000000000,191,169.110414800000,5.11295955900000;2,1,296.820000000000,322.180000000000,249,17,317.700000000000,406.200000000000,190,188.639475100000,5.30040111200000;3,16,179.980000000000,419.620000000000,191,18,233.180000000000,385.320000000000,180,76.8496417300000,3.81375669200000;4,17,317.700000000000,406.200000000000,190,19,265.500000000000,389.790000000000,183,64.0862690800000,4.66029427500000;5,18,233.180000000000,385.320000000000,180,36,251.080000000000,380.840000000000,167,27.2052251000000,2.40813904300000;6,19,265.500000000000,389.790000000000,183,36,251.080000000000,380.840000000000,167,28.0786030600000,4.29979508100000;7,18,233.180000000000,385.320000000000,180,20,216.770000000000,319.690000000000,187,82.4599229900000,2.86625531200000;8,20,216.770000000000,319.690000000000,187,21,214.290000000000,267.490000000000,190,59.6485724100000,3.22708258900000;9,21,214.290000000000,267.490000000000,190,128,121.310000000000,128.770000000000,169,205.653789800000,2.62411672500000;10,21,214.290000000000,267.490000000000,190,22,203.350000000000,261.520000000000,204,22.2428653200000,2.46399103500000;11,22,203.350000000000,261.520000000000,204,244,110.870000000000,303.280000000000,175,132.904952600000,2.47022869000000;12,22,203.350000000000,261.520000000000,204,143,125.790000000000,297.320000000000,195,113.554480000000,2.45898810600000;13,18,233.180000000000,385.320000000000,180,23,221.250000000000,335.100000000000,128,87.8297454400000,3.80478501000000;14,23,221.250000000000,335.100000000000,128,24,203.850000000000,319.190000000000,106,40.9886049800000,4.09924674600000;15,24,203.850000000000,319.190000000000,106,25,212.300000000000,290.850000000000,101,34.5374268100000,2.72210514700000;16,25,212.300000000000,290.850000000000,101,150,133.740000000000,223.730000000000,127,152.605170600000,2.00825898400000;17,25,212.300000000000,290.850000000000,101,26,160.590000000000,266.990000000000,118,76.4392755500000,2.46653099900000;18,26,160.590000000000,266.990000000000,118,136,94.4700000000000,254.060000000000,94,90.7501950400000,2.49519798800000;19,26,160.590000000000,266.990000000000,118,243,142.190000000000,247.100000000000,163,62.7292533800000,2.86747488900000;20,24,203.850000000000,319.190000000000,106,27,186.940000000000,322.670000000000,104,20.4231729900000,2.74463545600000;21,27,186.940000000000,322.670000000000,104,140,109.880000000000,304.770000000000,173,131.806760400000,2;22,27,186.940000000000,322.670000000000,104,28,165.070000000000,336.100000000000,87,37.2677418100000,2.76646915300000;23,28,165.070000000000,336.100000000000,87,29,146.670000000000,320.190000000000,76,33.1271975000000,2.73849115700000;24,29,146.670000000000,320.190000000000,76,245,72.0900000000000,289.860000000000,82,108.627111300000,2;25,29,146.670000000000,320.190000000000,76,139,79.0500000000000,290.850000000000,142,127.185186500000,2.59946307800000;26,23,221.250000000000,335.100000000000,128,54,140.210000000000,367.420000000000,179,142.181786300000,2.05472812300000;27,28,165.070000000000,336.100000000000,87,30,155.120000000000,347.530000000000,87,15.8453124700000,3.82062072000000;28,30,155.120000000000,347.530000000000,87,134,66.6200000000000,307.760000000000,81,144.917236800000,2.24817367300000;29,30,155.120000000000,347.530000000000,87,31,117.830000000000,383.830000000000,90,56.7669022800000,2.95618223200000;30,31,117.830000000000,383.830000000000,90,135,64.6300000000000,309.250000000000,89,106.359113000000,2.61546676400000;31,31,117.830000000000,383.830000000000,90,137,57.6700000000000,305.270000000000,116,200.266432300000,2.64754404000000;32,23,221.250000000000,335.100000000000,128,142,106.890000000000,322.670000000000,190,196.650450800000,2.31677456500000;33,19,265.500000000000,389.790000000000,183,32,256.050000000000,329.630000000000,185,66.0145624900000,2.35546621100000;34,32,256.050000000000,329.630000000000,185,155,327.150000000000,218.260000000000,152,176.657477800000,2.29804886000000;35,32,256.050000000000,329.630000000000,185,33,253.070000000000,288.860000000000,185,44.8950622100000,2.82892793500000;36,33,253.070000000000,288.860000000000,185,34,245.110000000000,210.310000000000,179,86.0593136400000,2.81233660800000;37,34,245.110000000000,210.310000000000,179,132,303.280000000000,106.890000000000,163,152.912369600000,2.20000000000000;38,34,245.110000000000,210.310000000000,179,131,303.280000000000,111.370000000000,158,163.887334800000,2.20000000000000;39,33,253.070000000000,288.860000000000,185,157,328.640000000000,250.080000000000,178,101.431828400000,2.34300078100000;40,33,253.070000000000,288.860000000000,185,35,286.880000000000,218.260000000000,146,166.346703700000,2.25180779700000;41,35,286.880000000000,218.260000000000,146,151,314.220000000000,209.810000000000,145,32.6046748300000,2.35487030900000;42,36,251.080000000000,380.840000000000,167,37,248.590000000000,369.910000000000,154,21.2390059100000,4.54306647800000;43,37,248.590000000000,369.910000000000,154,38,256.550000000000,332.120000000000,126,59.5139017600000,3.38885370100000;44,38,256.550000000000,332.120000000000,126,39,303.280000000000,322.180000000000,161,76.8454040500000,2.29093267200000;45,39,303.280000000000,322.180000000000,161,159,361.950000000000,296.320000000000,186,86.3521238100000,2.20000000000000;46,39,303.280000000000,322.180000000000,161,156,354.990000000000,290.360000000000,186,91.9972064600000,2;47,38,256.550000000000,332.120000000000,126,40,262.020000000000,318.700000000000,116,21.1833953900000,3.66283394800000;48,40,262.020000000000,318.700000000000,116,41,261.020000000000,284.390000000000,123,40.2009787900000,2.50000000000000;49,41,261.020000000000,284.390000000000,123,42,254.560000000000,254.060000000000,130,37.5225324000000,2.28491794500000;50,42,254.560000000000,254.060000000000,130,35,286.880000000000,218.260000000000,146,112.310584300000,2.20000000000000;51,42,254.560000000000,254.060000000000,130,35,286.880000000000,218.260000000000,146,63.1441450500000,1.50000000000000;52,40,262.020000000000,318.700000000000,116,43,281.900000000000,309.750000000000,97,34.8239278100000,2.99394007000000;53,43,281.900000000000,309.750000000000,97,44,294.330000000000,315.220000000000,89,18.8495716700000,3.30078554800000;54,44,294.330000000000,315.220000000000,89,45,306.760000000000,314.720000000000,82,18.0186331000000,2.61745586700000;55,45,306.760000000000,314.720000000000,82,154,381.340000000000,252.070000000000,101,127.760007900000,2;56,45,306.760000000000,314.720000000000,82,246,424.600000000000,309.750000000000,77,166.294629400000,2.54190493800000;57,44,294.330000000000,315.220000000000,89,46,334.610000000000,357.480000000000,88,61.3089774400000,2.94638110800000;58,46,334.610000000000,357.480000000000,88,47,389.790000000000,374.880000000000,106,72.2446435700000,2.44995551100000;59,47,389.790000000000,374.880000000000,106,153,409.180000000000,280.910000000000,112,136.188980300000,2.24117889200000;60,47,389.790000000000,374.880000000000,106,172,449.460000000000,383.330000000000,82,79.4390761700000,2.32839264200000;61,46,334.610000000000,357.480000000000,88,164,388.300000000000,361.950000000000,26,104.284145000000,2.65996283300000;62,43,281.900000000000,309.750000000000,97,48,288.370000000000,267.980000000000,101,50.3431580300000,2.20000000000000;63,48,288.370000000000,267.980000000000,101,166,312.730000000000,207.820000000000,113,84.5474886500000,2.19572901800000;64,48,288.370000000000,267.980000000000,101,162,357.970000000000,273.950000000000,163,128.234653900000,2.37621433000000;65,41,261.020000000000,284.390000000000,123,158,375.870000000000,298.810000000000,177,177.373464100000,2.15507782200000;66,37,248.590000000000,369.910000000000,154,49,245.610000000000,372.390000000000,143,15.3660935200000,3.70415916600000;67,49,245.610000000000,372.390000000000,143,50,229.700000000000,374.380000000000,121,31.6966279400000,3.26340140800000;68,50,229.700000000000,374.380000000000,121,51,207.330000000000,379.350000000000,105,33.7446091100000,2.83817042700000;69,51,207.330000000000,379.350000000000,105,247,103.910000000000,309.750000000000,166,174.840317000000,2.25108405800000;70,51,207.330000000000,379.350000000000,105,52,163.080000000000,390.790000000000,117,55.3182642700000,2.79680637100000;71,52,163.080000000000,390.790000000000,117,144,95.9600000000000,338.090000000000,186,145.358703400000,2.80599157200000;72,52,163.080000000000,390.790000000000,117,147,86.5100000000000,372.390000000000,197,169.089612200000,2.53451655900000;73,51,207.330000000000,379.350000000000,105,53,191.420000000000,384.320000000000,131,36.3309601200000,3.00536786700000;74,53,191.420000000000,384.320000000000,131,54,140.210000000000,367.420000000000,179,93.6389394900000,2.37027338800000;75,54,140.210000000000,367.420000000000,179,145,94.9600000000000,362.450000000000,199,60.0283284800000,3.35770827100000;76,53,191.420000000000,384.320000000000,131,148,76.5700000000000,403.220000000000,213,199.614758100000,2.53333650600000;77,50,229.700000000000,374.380000000000,121,146,92.4800000000000,363.940000000000,197,226.521577500000,2.37845971500000;78,49,245.610000000000,372.390000000000,143,55,264.500000000000,372.390000000000,115,39.7498620200000,2.99642871600000;79,55,264.500000000000,372.390000000000,115,56,275.440000000000,374.880000000000,112,13.5257473000000,4.03428021900000;80,56,275.440000000000,374.880000000000,112,57,312.230000000000,388.800000000000,153,72.5278089900000,2.95750346900000;81,57,312.230000000000,388.800000000000,153,58,386.810000000000,350.020000000000,191,144.447486900000,2.27780996900000;82,57,312.230000000000,388.800000000000,153,58,386.810000000000,350.020000000000,191,115.814387600000,2.38291283500000;83,58,386.810000000000,350.020000000000,191,169,399.240000000000,339.580000000000,191,17.0456230800000,2.85427656700000;84,56,275.440000000000,374.880000000000,112,59,388.800000000000,378.850000000000,143,142.950224300000,2.55494661300000;85,59,388.800000000000,378.850000000000,143,161,398.740000000000,337.090000000000,190,81.0243990000000,2.53654614200000;86,59,388.800000000000,378.850000000000,143,60,407.690000000000,391.280000000000,156,33.1180884100000,2.08266379400000;87,60,407.690000000000,391.280000000000,156,167,414.160000000000,355.490000000000,201,81.1530730400000,1.80000000000000;88,60,407.690000000000,391.280000000000,156,168,451.940000000000,406.700000000000,187,77.2687311600000,1.80000000000000;89,55,264.500000000000,372.390000000000,115,160,386.310000000000,315.710000000000,184,196.806872400000,2.17329548100000;90,16,179.980000000000,419.620000000000,191,61,211.800000000000,429.070000000000,195,38.6337728300000,4.69199545000000;91,17,317.700000000000,406.200000000000,190,62,290.850000000000,420.120000000000,196,38.7207985200000,4.91885446400000;92,61,211.800000000000,429.070000000000,195,241,249.590000000000,468.350000000000,203,64.3261016600000,5.26966299600000;93,62,290.850000000000,420.120000000000,196,241,249.590000000000,468.350000000000,203,71.1684816100000,5.09750891800000;94,16,179.980000000000,419.620000000000,191,203,142.190000000000,444.480000000000,80,223.081795300000,2.47372179000000;95,17,317.700000000000,406.200000000000,190,173,361.450000000000,424.100000000000,74,233.292242100000,2.59802065700000;96,61,211.800000000000,429.070000000000,195,63,228.710000000000,415.150000000000,132,81.8271330500000,2.67756378800000;97,63,228.710000000000,415.150000000000,132,238,349.520000000000,470.830000000000,181,202.297089800000,2.38250301700000;98,63,228.710000000000,415.150000000000,132,197,118.330000000000,482.770000000000,163,209.522948300000,2.20000000000000;99,63,228.710000000000,415.150000000000,132,64,200.370000000000,478.790000000000,93,132.764358800000,2.08415383400000;100,64,200.370000000000,478.790000000000,93,179,140.210000000000,505.640000000000,158,117.577071500000,2.20000000000000;101,64,200.370000000000,478.790000000000,93,65,224.230000000000,483.260000000000,102,32.7137371400000,1.50000000000000;102,65,224.230000000000,483.260000000000,102,196,154.130000000000,505.140000000000,179,150.436044400000,2.20000000000000;103,62,290.850000000000,420.120000000000,196,66,272.950000000000,405.700000000000,154,58.9403360400000,2.57465185700000;104,66,272.950000000000,405.700000000000,154,239,357.970000000000,468.350000000000,184,151.731903500000,2.13292137400000;105,66,272.950000000000,405.700000000000,154,67,267.490000000000,412.660000000000,113,46.9343535000000,2.38013558800000;106,67,267.490000000000,412.660000000000,113,68,333.110000000000,450.450000000000,115,98.8277096400000,2.52453025300000;107,68,333.110000000000,450.450000000000,115,234,378.360000000000,466.860000000000,140,72.6544730100000,2.16395838400000;108,68,333.110000000000,450.450000000000,115,234,378.360000000000,466.860000000000,140,65.5243386200000,2.23748921500000;109,67,267.490000000000,412.660000000000,113,85,353.500000000000,489.730000000000,134,190.976011500000,2.20789848300000;110,69,258.040000000000,524.030000000000,198,70,254.560000000000,508.620000000000,114,99.1760807000000,2.95267074700000;111,70,254.560000000000,508.620000000000,114,83,259.030000000000,504.150000000000,113,7.13870028400000,2.86226318100000;112,70,254.560000000000,508.620000000000,114,71,246.110000000000,507.130000000000,103,16.3454989000000,3.12104231600000;113,71,246.110000000000,507.130000000000,103,65,224.230000000000,483.260000000000,102,39.9271757600000,2.20000000000000;114,71,246.110000000000,507.130000000000,103,72,166.560000000000,519.060000000000,69,107.117350100000,2.19453266500000;115,72,166.560000000000,519.060000000000,69,73,153.130000000000,507.630000000000,65,22.2505808900000,2.54768519200000;116,73,153.130000000000,507.630000000000,65,199,86.5100000000000,484.260000000000,78,86.9557252000000,2.27593749800000;117,73,153.130000000000,507.630000000000,65,178,132.750000000000,506.630000000000,145,93.8307596400000,2.24147679400000;118,72,166.560000000000,519.060000000000,69,74,146.670000000000,534.970000000000,64,32.4987174800000,1.99747472300000;119,74,146.670000000000,534.970000000000,64,198,97.9500000000000,488.730000000000,129,118.483520100000,2.59912340700000;120,74,146.670000000000,534.970000000000,64,75,140.700000000000,578.230000000000,48,57.1883734900000,1.44911887500000;121,75,140.700000000000,578.230000000000,48,81,133.250000000000,618.500000000000,40,57.1127848400000,2.15847489800000;122,75,140.700000000000,578.230000000000,48,79,153.630000000000,580.210000000000,51,15.4088142200000,1.50000000000000;123,71,246.110000000000,507.130000000000,103,76,213.290000000000,539.450000000000,68,73.1254472100000,2.16309610000000;124,76,213.290000000000,539.450000000000,68,185,160.090000000000,610.050000000000,121,167.411023500000,2.21115451900000;125,76,213.290000000000,539.450000000000,68,77,213.790000000000,553.860000000000,69,15.6557782200000,2.91852729600000;126,77,213.790000000000,553.860000000000,69,78,169.540000000000,575.740000000000,58,59.5247665600000,2.44513306700000;127,78,169.540000000000,575.740000000000,58,79,153.630000000000,580.210000000000,51,21.7997314200000,2.23639045700000;128,79,153.630000000000,580.210000000000,51,80,145.180000000000,616.510000000000,73,53.2053372000000,2.96157639200000;129,80,145.180000000000,616.510000000000,73,248,135.230000000000,624.460000000000,73,15.0493197300000,2.93017375300000;130,80,145.180000000000,616.510000000000,73,189,144.680000000000,659.760000000000,69,66.0295711600000,2.03056896200000;131,78,169.540000000000,575.740000000000,58,81,133.250000000000,618.500000000000,40,78.1931360500000,1.81806262800000;132,81,133.250000000000,618.500000000000,40,188,132.250000000000,624.460000000000,66,29.1454135500000,2.07020397000000;133,77,213.790000000000,553.860000000000,69,82,218.760000000000,557.340000000000,72,9.49073461900000,3.28310770200000;134,82,218.760000000000,557.340000000000,72,193,177.500000000000,595.130000000000,131,99.3652667700000,1.50000000000000;135,83,259.030000000000,504.150000000000,113,84,258.040000000000,476.800000000000,125,37.1102736900000,2.11441911100000;136,84,258.040000000000,476.800000000000,125,85,353.500000000000,489.730000000000,134,125.082578900000,2;137,85,353.500000000000,489.730000000000,134,227,364.440000000000,490.720000000000,145,18.8683028800000,2.46211604500000;138,83,259.030000000000,504.150000000000,113,86,266.490000000000,502.160000000000,92,26.1775432200000,2.41817184900000;139,86,266.490000000000,502.160000000000,92,96,286.880000000000,551.380000000000,70,80.4948720600000,1.50000000000000;140,86,266.490000000000,502.160000000000,92,87,284.390000000000,498.680000000000,76,28.7523904200000,2.27736663200000;141,87,284.390000000000,498.680000000000,76,88,336.590000000000,488.730000000000,62,65.3343086600000,2.08559631200000;142,88,336.590000000000,488.730000000000,62,171,412.660000000000,458.900000000000,123,146.396684200000,2.40780105600000;143,88,336.590000000000,488.730000000000,62,230,367.920000000000,487.740000000000,145,138.524070300000,2.67140244800000;144,84,258.040000000000,476.800000000000,125,89,243.620000000000,473.320000000000,149,36.1191639800000,2.23815663800000;145,89,243.620000000000,473.320000000000,149,207,168.050000000000,473.320000000000,193,119.430132000000,2.47942046900000;146,89,243.620000000000,473.320000000000,149,208,177.500000000000,503.650000000000,194,115.637159100000,1.50000000000000;147,90,257.040000000000,592.640000000000,163,91,257.040000000000,572.260000000000,130,50.9489019400000,2.40083997500000;148,91,257.040000000000,572.260000000000,130,92,256.050000000000,566.790000000000,130,5.88091573800000,2.20000000000000;149,92,256.050000000000,566.790000000000,130,93,266.490000000000,565.300000000000,135,15.1976237900000,2.20000000000000;150,93,266.490000000000,565.300000000000,135,221,336.590000000000,572.760000000000,139,81.1896064500000,2.20000000000000;151,93,266.490000000000,565.300000000000,135,223,330.630000000000,527.510000000000,160,124.728925700000,2.20000000000000;152,92,256.050000000000,566.790000000000,130,190,181.470000000000,588.670000000000,141,118.153978400000,2.20000000000000;153,92,256.050000000000,566.790000000000,130,82,218.760000000000,557.340000000000,72,93.0258367400000,2.18897702900000;154,94,258.040000000000,595.630000000000,161,95,273.950000000000,563.810000000000,73,109.950089600000,2.50000000000000;155,95,273.950000000000,563.810000000000,73,96,286.880000000000,551.380000000000,70,20.7982786200000,2.20000000000000;156,96,286.880000000000,551.380000000000,70,101,352.010000000000,589.660000000000,127,116.254313000000,2.20000000000000;157,95,273.950000000000,563.810000000000,73,220,368.910000000000,606.570000000000,107,145.253383000000,2.20000000000000;158,87,284.390000000000,498.680000000000,76,97,318.700000000000,526.520000000000,62,54.8660169800000,2.89116989100000;159,97,318.700000000000,526.520000000000,62,98,348.530000000000,530,61,32.2038876400000,2.90339183400000;160,98,348.530000000000,530,61,99,357.480000000000,523.040000000000,61,11.8324991700000,2.73365889800000;161,99,357.480000000000,523.040000000000,61,100,360.960000000000,526.520000000000,65,7.49095987800000,2.98050045100000;162,100,360.960000000000,526.520000000000,65,228,379.350000000000,524.530000000000,61,23.1449673600000,2.27081148100000;163,100,360.960000000000,526.520000000000,65,101,352.010000000000,589.660000000000,127,110.121342000000,2.47198912100000;164,101,352.010000000000,589.660000000000,127,249,355.980000000000,598.610000000000,127,10.5968547200000,3.42651918900000;165,99,357.480000000000,523.040000000000,61,171,412.660000000000,458.900000000000,123,156.205436200000,2.85631900700000;166,98,348.530000000000,530,61,219,375.870000000000,612.030000000000,67,108.832580000000,2.39468071700000;167,97,318.700000000000,526.520000000000,62,102,345.050000000000,576.240000000000,39,73.6712157900000,2.73758580200000;168,102,345.050000000000,576.240000000000,39,219,375.870000000000,612.030000000000,67,76.1925475900000,2.73910352500000;169,102,345.050000000000,576.240000000000,39,216,362.450000000000,653.800000000000,92,126.457573500000,2.47665539200000;170,103,258.040000000000,603.090000000000,158,104,257.040000000000,594.630000000000,123,39.6037015900000,2.50000000000000;171,104,257.040000000000,594.630000000000,123,105,167.550000000000,624.960000000000,116,135.902080500000,2.20000000000000;172,104,257.040000000000,594.630000000000,123,105,167.550000000000,624.960000000000,116,187.281028100000,2;173,105,167.550000000000,624.960000000000,116,186,154.620000000000,622.480000000000,121,16.6534050100000,2.60227238600000;174,97,318.700000000000,526.520000000000,62,222,331.620000000000,547.900000000000,139,96.1800004100000,2.07520570900000;175,106,261.520000000000,634.410000000000,139,107,264.010000000000,622.480000000000,98,45.8526615900000,2.31414001900000;176,107,264.010000000000,622.480000000000,98,217,357.480000000000,651.310000000000,100,109.143697800000,2.20000000000000;177,107,264.010000000000,622.480000000000,98,108,274.450000000000,624.460000000000,56,57.0373394900000,2.58710058200000;178,108,274.450000000000,624.460000000000,56,218,354.490000000000,628.440000000000,99,113.117408400000,2.50000000000000;179,108,274.450000000000,624.460000000000,56,214,364.440000000000,678.660000000000,76,135.918689600000,2.50000000000000;180,109,263.510000000000,659.760000000000,128,110,261.020000000000,648.330000000000,103,31.2575118600000,2.73730769100000;181,110,261.020000000000,648.330000000000,103,211,340.070000000000,691.580000000000,90,107.425499900000,2.50000000000000;182,110,261.020000000000,648.330000000000,103,184,163.570000000000,643.850000000000,99,177.527333700000,2.20000000000000;183,87,284.390000000000,498.680000000000,76,225,346.540000000000,506.630000000000,146,114.490927500000,2.20000000000000;184,111,268.480000000000,699.540000000000,106,112,264.500000000000,693.570000000000,87,22.6328944800000,2.95227955700000;185,112,264.500000000000,693.570000000000,87,181,185.450000000000,696.060000000000,94,103.088585200000,2.20000000000000;186,112,264.500000000000,693.570000000000,87,113,265.990000000000,686.610000000000,55,34.5436615600000,2.93892925300000;187,113,265.990000000000,686.610000000000,55,212,351.510000000000,718.430000000000,53,106.458346200000,2.20000000000000;188,113,265.990000000000,686.610000000000,55,182,164.070000000000,688.600000000000,77,132.767983200000,2.20000000000000;189,114,267.490000000000,720.920000000000,97,180,179.980000000000,718.430000000000,63,146.298897200000,2.20000000000000;190,115,257.540000000000,739.810000000000,85,4,206.330000000000,777.100000000000,20,118.015177800000,2;191,90,257.040000000000,592.640000000000,163,195,181.470000000000,504.640000000000,204,158.115193600000,1.76211510400000;192,115,257.540000000000,739.810000000000,85,116,289.860000000000,750.250000000000,83,38.7750640200000,2;193,116,289.860000000000,750.250000000000,83,117,295.330000000000,752.740000000000,78,9.39616689100000,2;194,117,295.330000000000,752.740000000000,78,5,338.580000000000,766.160000000000,22,90.5633950000000,2;195,117,295.330000000000,752.740000000000,78,6,257.040000000000,818.860000000000,54,105.624269200000,2;196,2,217.770000000000,139.210000000000,231,118,214.780000000000,135.730000000000,203,29.9408038100000,2.50000000000000;197,118,214.780000000000,135.730000000000,203,119,220.250000000000,131.750000000000,186,21.2658255900000,2.50000000000000;198,119,220.250000000000,131.750000000000,186,133,268.480000000000,68.1100000000000,191,103.914226600000,2.20000000000000;199,119,220.250000000000,131.750000000000,186,120,236.160000000000,120.820000000000,131,73.6380244700000,2.79246090200000;200,120,236.160000000000,120.820000000000,131,130,305.270000000000,104.410000000000,146,87.9621323500000,2.20000000000000;201,120,236.160000000000,120.820000000000,131,129,293.340000000000,70.1000000000000,155,122.088105600000,2.20000000000000;202,120,236.160000000000,120.820000000000,131,240,303.280000000000,94.4700000000000,130,93.3514006100000,2.20000000000000;203,118,214.780000000000,135.730000000000,203,121,201.360000000000,130.760000000000,175,37.2978701400000,3.14679995000000;204,121,201.360000000000,130.760000000000,175,242,143.690000000000,80.5400000000000,197,93.0415243800000,2.70399677900000;205,121,201.360000000000,130.760000000000,175,125,119.820000000000,76.0700000000000,157,162.213982800000,2.31618173700000;206,3,155.620000000000,196.890000000000,214,122,140.210000000000,200.860000000000,171,52.4577157700000,2.71791849800000;207,122,140.210000000000,200.860000000000,171,123,171.030000000000,167.050000000000,147,75.8100895900000,2.05513608000000;208,123,171.030000000000,167.050000000000,147,124,136.230000000000,123.300000000000,141,84.2565182100000,2.20000000000000;209,123,171.030000000000,167.050000000000,147,124,136.230000000000,123.300000000000,141,69.7276173800000,2.15837126800000;210,124,136.230000000000,123.300000000000,141,126,116.340000000000,106.890000000000,150,32.1499508600000,2.47240500900000;211,125,119.820000000000,76.0700000000000,157,127,121.310000000000,90.4900000000000,134,31.8916888600000,2.86184422100000;212,126,116.340000000000,106.890000000000,150,127,121.310000000000,90.4900000000000,134,29.7917981400000,3.19219198300000;213,127,121.310000000000,90.4900000000000,134,7,202.850000000000,139.710000000000,88,128.716124300000,3.78058432800000;214,128,121.310000000000,128.770000000000,169,126,116.340000000000,106.890000000000,150,35.3863421600000,3.78534795200000;215,129,293.340000000000,70.1000000000000,155,240,303.280000000000,94.4700000000000,130,44.4004864700000,3.12429657200000;216,130,305.270000000000,104.410000000000,146,240,303.280000000000,94.4700000000000,130,22.0239560800000,3.26831561900000;217,131,303.280000000000,111.370000000000,158,132,303.280000000000,106.890000000000,163,8.64505681600000,4.18301162300000;218,132,303.280000000000,106.890000000000,163,130,305.270000000000,104.410000000000,146,18.4091978900000,4.73007857600000;219,133,268.480000000000,68.1100000000000,191,132,303.280000000000,106.890000000000,163,74.9373334100000,3.19250806400000;220,134,66.6200000000000,307.760000000000,81,245,72.0900000000000,289.860000000000,82,20.6833307500000,3.35715770100000;221,135,64.6300000000000,309.250000000000,89,134,66.6200000000000,307.760000000000,81,11.4759953900000,4.07788995800000;222,136,94.4700000000000,254.060000000000,94,138,75.0700000000000,277.930000000000,117,44.9248693200000,2.98269192800000;223,137,57.6700000000000,305.270000000000,116,138,75.0700000000000,277.930000000000,117,36.2113402500000,3.68927453800000;224,138,75.0700000000000,277.930000000000,117,139,79.0500000000000,290.850000000000,142,33.0083966800000,3.90975867900000;225,139,79.0500000000000,290.850000000000,142,247,103.910000000000,309.750000000000,166,47.6857534700000,6.31683357300000;226,140,109.880000000000,304.770000000000,173,244,110.870000000000,303.280000000000,175,4.13699206200000,5.19929157400000;227,141,117.830000000000,239.150000000000,151,244,110.870000000000,303.280000000000,175,86.0934673400000,3.45664230900000;228,140,109.880000000000,304.770000000000,173,142,106.890000000000,322.670000000000,190,33.4255354100000,3.97055969300000;229,142,106.890000000000,322.670000000000,190,144,95.9600000000000,338.090000000000,186,22.4122414500000,5.23870385600000;230,143,125.790000000000,297.320000000000,195,142,106.890000000000,322.670000000000,190,35.9793407300000,3.67832178200000;231,144,95.9600000000000,338.090000000000,186,145,94.9600000000000,362.450000000000,199,34.5872552400000,6.35985782300000;232,145,94.9600000000000,362.450000000000,199,146,92.4800000000000,363.940000000000,197,4.14239693800000,7.82493376100000;233,146,92.4800000000000,363.940000000000,197,147,86.5100000000000,372.390000000000,197,10.9234327500000,7.39224747100000;234,147,86.5100000000000,372.390000000000,197,149,77.0600000000000,377.860000000000,213,25.9625710200000,6.44969814800000;235,148,76.5700000000000,403.220000000000,213,149,77.0600000000000,377.860000000000,213,26.7980167400000,5.20802513500000;236,149,77.0600000000000,377.860000000000,213,8,94.9600000000000,393.770000000000,247,57.7443698200000,5.40401667400000;237,142,106.890000000000,322.670000000000,190,9,116.840000000000,337.090000000000,247,72.1376559100000,3.78506445000000;238,150,133.740000000000,223.730000000000,127,141,117.830000000000,239.150000000000,151,39.7250609500000,3.17452637100000;239,151,314.220000000000,209.810000000000,145,155,327.150000000000,218.260000000000,152,21.4285886600000,2.62683510300000;240,45,306.760000000000,314.720000000000,82,152,354.990000000000,231.690000000000,80,170.863295600000,2.57473751500000;241,152,354.990000000000,231.690000000000,80,154,381.340000000000,252.070000000000,101,49.1201522700000,3.15208652200000;242,153,409.180000000000,280.910000000000,112,154,381.340000000000,252.070000000000,101,49.4254255000000,3.09562492600000;243,154,381.340000000000,252.070000000000,101,163,364.440000000000,279.920000000000,163,86.8656138900000,4.22035479200000;244,155,327.150000000000,218.260000000000,152,162,357.970000000000,273.950000000000,163,77.0876152000000,2.70491567000000;245,156,354.990000000000,290.360000000000,186,159,361.950000000000,296.320000000000,186,10.8381293000000,3.29766571100000;246,157,328.640000000000,250.080000000000,178,158,375.870000000000,298.810000000000,177,70.5552840100000,3.09587233400000;247,158,375.870000000000,298.810000000000,177,160,386.310000000000,315.710000000000,184,25.6473427000000,4.96659506800000;248,159,361.950000000000,296.320000000000,186,160,386.310000000000,315.710000000000,184,34.4267705300000,4.20403397400000;249,160,386.310000000000,315.710000000000,184,161,398.740000000000,337.090000000000,190,29.6434207900000,5.54513185000000;250,161,398.740000000000,337.090000000000,190,169,399.240000000000,339.580000000000,191,3.31145836100000,5.09446649100000;251,162,357.970000000000,273.950000000000,163,163,364.440000000000,279.920000000000,163,9.22593721300000,5.01362519600000;252,163,364.440000000000,279.920000000000,163,158,375.870000000000,298.810000000000,177,31.8822294900000,4.28854234400000;253,154,381.340000000000,252.070000000000,101,246,424.600000000000,309.750000000000,77,90.8150515300000,3.34120283200000;254,164,388.300000000000,361.950000000000,26,165,432.550000000000,362.950000000000,58,68.4935874200000,4.29031448200000;255,165,432.550000000000,362.950000000000,58,246,424.600000000000,309.750000000000,77,70.0498704200000,3.28105865200000;256,166,312.730000000000,207.820000000000,113,155,327.150000000000,218.260000000000,152,54.8724004300000,3.04865030800000;257,167,414.160000000000,355.490000000000,201,170,405.210000000000,339.580000000000,204,21.6869756800000,2;258,168,451.940000000000,406.700000000000,187,167,414.160000000000,355.490000000000,201,92.0798521600000,2;259,169,399.240000000000,339.580000000000,191,170,405.210000000000,339.580000000000,204,16.9374067500000,5.71601708700000;260,170,405.210000000000,339.580000000000,204,10,386.310000000000,352.500000000000,245,66.4970954400000,4.91927565000000;261,76,213.290000000000,539.450000000000,68,191,177.990000000000,548.890000000000,141,103.870649100000,2.18502585900000;262,71,246.110000000000,507.130000000000,103,192,165.560000000000,522.040000000000,153,137.480889300000,1.71965187500000;263,171,412.660000000000,458.900000000000,123,250,417.140000000000,445.970000000000,77,54.4078204900000,3.74953594000000;264,165,432.550000000000,362.950000000000,58,172,449.460000000000,383.330000000000,82,49.2207672500000,3.56511793300000;265,172,449.460000000000,383.330000000000,82,250,417.140000000000,445.970000000000,77,123.885048900000,2.47985211000000;266,173,361.450000000000,424.100000000000,74,174,406.200000000000,441,72,53.1991606600000,1.81269532800000;267,174,406.200000000000,441,72,250,417.140000000000,445.970000000000,77,17.6500888000000,2.39492359400000;268,173,361.450000000000,424.100000000000,74,175,309.750000000000,409.680000000000,33,84.7331407900000,2.57703023100000;269,175,309.750000000000,409.680000000000,33,176,340.570000000000,456.420000000000,25,73.8392275200000,2.84400403600000;270,176,340.570000000000,456.420000000000,25,174,406.200000000000,441,72,105.959718200000,2.23468946800000;271,176,340.570000000000,456.420000000000,25,250,417.140000000000,445.970000000000,77,164.319323700000,2.26192823900000;272,72,166.560000000000,519.060000000000,69,177,139.710000000000,517.570000000000,145,93.0850878700000,2.11499452500000;273,177,139.710000000000,517.570000000000,145,178,132.750000000000,506.630000000000,145,14.2331203800000,4.17685624900000;274,178,132.750000000000,506.630000000000,145,179,140.210000000000,505.640000000000,158,19.3545379200000,3.45224860100000;275,179,140.210000000000,505.640000000000,158,197,118.330000000000,482.770000000000,163,37.7417703600000,3.12146066700000;276,180,179.980000000000,718.430000000000,63,182,164.070000000000,688.600000000000,77,44.4843338900000,4.04723211300000;277,181,185.450000000000,696.060000000000,94,182,164.070000000000,688.600000000000,77,37.9651338800000,2.32294210200000;278,182,164.070000000000,688.600000000000,77,183,161.090000000000,678.660000000000,92,21.9054074600000,3.20553397700000;279,181,185.450000000000,696.060000000000,94,183,161.090000000000,678.660000000000,92,35.2298354100000,3.47254906600000;280,183,161.090000000000,678.660000000000,92,184,163.570000000000,643.850000000000,99,41.0731658900000,2.99989088200000;281,184,163.570000000000,643.850000000000,99,187,149.160000000000,625.460000000000,116,35.1526645900000,2.64429247300000;282,185,160.090000000000,610.050000000000,121,186,154.620000000000,622.480000000000,121,14.6949714700000,2.62544794500000;283,186,154.620000000000,622.480000000000,121,187,149.160000000000,625.460000000000,116,11.5018397000000,2.63660851500000;284,187,149.160000000000,625.460000000000,116,248,135.230000000000,624.460000000000,73,50.1516622800000,2.84787443900000;285,188,132.250000000000,624.460000000000,66,248,135.230000000000,624.460000000000,73,8.39268793600000,2.20000000000000;286,189,144.680000000000,659.760000000000,69,183,161.090000000000,678.660000000000,92,48.7847270700000,2.67471958700000;287,187,149.160000000000,625.460000000000,116,11,130.760000000000,628.940000000000,113,30.5634920500000,5;288,190,181.470000000000,588.670000000000,141,193,177.500000000000,595.130000000000,131,14.2861949500000,2.61428655000000;289,191,177.990000000000,548.890000000000,141,190,181.470000000000,588.670000000000,141,42.4520242200000,2.50000000000000;290,192,165.560000000000,522.040000000000,153,191,177.990000000000,548.890000000000,141,42.1029762900000,2.50000000000000;291,193,177.500000000000,595.130000000000,131,194,173.520000000000,602.090000000000,133,9.64676503800000,2.98271645000000;292,194,173.520000000000,602.090000000000,133,185,160.090000000000,610.050000000000,121,24.9739131800000,3.32535546900000;293,194,173.520000000000,602.090000000000,133,105,167.550000000000,624.960000000000,116,48.0023279100000,2.50000000000000;294,195,181.470000000000,504.640000000000,204,208,177.500000000000,503.650000000000,194,11.9063828300000,2.91315838800000;295,196,154.130000000000,505.140000000000,179,179,140.210000000000,505.640000000000,158,28.0419371800000,2.62352187900000;296,197,118.330000000000,482.770000000000,163,210,105.900000000000,473.820000000000,166,19.1806816600000,3.50498612100000;297,198,97.9500000000000,488.730000000000,129,210,105.900000000000,473.820000000000,166,48.1149457100000,3.75568268700000;298,198,97.9500000000000,488.730000000000,129,200,93.4700000000000,478.290000000000,101,33.6145814100000,3.41717747400000;299,199,86.5100000000000,484.260000000000,78,200,93.4700000000000,478.290000000000,101,30.7862563600000,2.64411364300000;300,200,93.4700000000000,478.290000000000,101,201,110.870000000000,462.380000000000,72,42.8304492200000,2.91096680700000;301,201,110.870000000000,462.380000000000,72,202,119.820000000000,469.840000000000,55,24.9585714800000,3.30949083500000;302,202,119.820000000000,469.840000000000,55,206,122.800000000000,481.770000000000,48,17.2044297400000,2.59231439800000;303,203,142.190000000000,444.480000000000,80,204,171.530000000000,430.060000000000,40,61.3394494800000,2.68882253900000;304,204,171.530000000000,430.060000000000,40,205,164.070000000000,467.850000000000,33,73.6499034300000,2.89180224600000;305,205,164.070000000000,467.850000000000,33,202,119.820000000000,469.840000000000,55,60.0195147200000,2.29749111900000;306,205,164.070000000000,467.850000000000,33,206,122.800000000000,481.770000000000,48,60.7724289200000,2.61588974200000;307,206,122.800000000000,481.770000000000,48,199,86.5100000000000,484.260000000000,78,94.7196108500000,2.06325783000000;308,201,110.870000000000,462.380000000000,72,203,142.190000000000,444.480000000000,80,43.6725964200000,2;309,207,168.050000000000,473.320000000000,193,209,137.720000000000,489.730000000000,182,45.2970510600000,3.05654464200000;310,208,177.500000000000,503.650000000000,194,209,137.720000000000,489.730000000000,182,53.1124895100000,2;311,209,137.720000000000,489.730000000000,182,197,118.330000000000,482.770000000000,163,33.3231087400000,2.86687802100000;312,210,105.900000000000,473.820000000000,166,12,90.4900000000000,411.170000000000,247,145.715643500000,4.42956974800000;313,211,340.070000000000,691.580000000000,90,213,348.530000000000,707,76,28.6539859000000,3;314,211,340.070000000000,691.580000000000,90,215,363.940000000000,667.720000000000,92,39.8786923500000,3;315,212,351.510000000000,718.430000000000,53,213,348.530000000000,707,76,34.4513721600000,3.41030575300000;316,213,348.530000000000,707,76,214,364.440000000000,678.660000000000,76,41.7596113200000,3.80000000000000;317,214,364.440000000000,678.660000000000,76,215,363.940000000000,667.720000000000,92,22.0407613700000,3.18243889000000;318,215,363.940000000000,667.720000000000,92,216,362.450000000000,653.800000000000,92,14.9508818100000,3.48697550400000;319,216,362.450000000000,653.800000000000,92,217,357.480000000000,651.310000000000,100,11.5185749200000,3.64239122900000;320,217,357.480000000000,651.310000000000,100,218,354.490000000000,628.440000000000,99,25.8611208100000,4.24540259800000;321,218,354.490000000000,628.440000000000,99,220,368.910000000000,606.570000000000,107,33.8476608700000,2.72694875800000;322,219,375.870000000000,612.030000000000,67,218,354.490000000000,628.440000000000,99,48.9855667800000,3.09488723100000;323,220,368.910000000000,606.570000000000,107,249,355.980000000000,598.610000000000,127,32.0844584600000,3.04346685000000;324,101,352.010000000000,589.660000000000,127,221,336.590000000000,572.760000000000,139,31.6673424000000,2.51305878300000;325,221,336.590000000000,572.760000000000,139,222,331.620000000000,547.900000000000,139,28.4694535000000,3;326,222,331.620000000000,547.900000000000,139,223,330.630000000000,527.510000000000,160,35.7257259400000,3;327,223,330.630000000000,527.510000000000,160,224,334.110000000000,522.540000000000,151,12.6296526000000,3;328,224,334.110000000000,522.540000000000,151,225,346.540000000000,506.630000000000,146,29.1089793200000,3;329,225,346.540000000000,506.630000000000,146,226,359.960000000000,498.180000000000,145,17.4443108100000,3;330,226,359.960000000000,498.180000000000,145,227,364.440000000000,490.720000000000,145,9.31124066100000,2.76476367800000;331,227,364.440000000000,490.720000000000,145,230,367.920000000000,487.740000000000,145,4.71593897700000,3.49840713900000;332,228,379.350000000000,524.530000000000,61,229,366.430000000000,507.130000000000,132,84.1773147600000,2.55131879300000;333,224,334.110000000000,522.540000000000,151,229,366.430000000000,507.130000000000,132,51.2777982300000,1.50000000000000;334,229,366.430000000000,507.130000000000,132,226,359.960000000000,498.180000000000,145,20.7811586300000,2.06102808800000;335,230,367.920000000000,487.740000000000,145,232,371.400000000000,472.330000000000,156,24.9536138900000,2.94611851700000;336,228,379.350000000000,524.530000000000,61,231,407.690000000000,489.730000000000,132,146.500798500000,2.20000000000000;337,231,407.690000000000,489.730000000000,132,232,371.400000000000,472.330000000000,156,59.9612798400000,2.20000000000000;338,231,407.690000000000,489.730000000000,132,233,408.690000000000,463.870000000000,142,36.9933740100000,2.14776499800000;339,232,371.400000000000,472.330000000000,156,236,389.300000000000,457.910000000000,165,31.3144803300000,3.43660157100000;340,233,408.690000000000,463.870000000000,142,235,389.300000000000,465.860000000000,150,25.3820646100000,2.91107353400000;341,234,378.360000000000,466.860000000000,140,235,389.300000000000,465.860000000000,150,18.2598150000000,2.39560722600000;342,235,389.300000000000,465.860000000000,150,236,389.300000000000,457.910000000000,165,22.6196382100000,3.09796111900000;343,236,389.300000000000,457.910000000000,165,237,399.740000000000,443.490000000000,165,20.8204187200000,3.31881178900000;344,233,408.690000000000,463.870000000000,142,237,399.740000000000,443.490000000000,165,38.2005563100000,3.71156401400000;345,237,399.740000000000,443.490000000000,165,13,400.230000000000,379.350000000000,242,132.713955900000,4.16011352800000;346,220,368.910000000000,606.570000000000,107,14,385.320000000000,601.590000000000,99,23.4340636000000,5;347,238,349.520000000000,470.830000000000,181,239,357.970000000000,468.350000000000,184,12.2550977300000,2.45368529400000;348,239,357.970000000000,468.350000000000,184,232,371.400000000000,472.330000000000,156,39.7114372300000,3.16688217800000;349,240,303.280000000000,94.4700000000000,130,15,225.720000000000,142.190000000000,86,129.416772200000,4.05743084400000;350,241,249.590000000000,468.350000000000,203,69,258.040000000000,524.030000000000,198,66.3130264700000,5.78906309600000;351,69,258.040000000000,524.030000000000,198,90,257.040000000000,592.640000000000,163,97.5524203700000,3.92483983300000;352,90,257.040000000000,592.640000000000,163,94,258.040000000000,595.630000000000,161,4.63417699400000,5.27360221200000;353,94,258.040000000000,595.630000000000,161,103,258.040000000000,603.090000000000,158,9.72843434200000,4.65086171400000;354,103,258.040000000000,603.090000000000,158,106,261.520000000000,634.410000000000,139,44.6161053800000,4.04303303200000;355,106,261.520000000000,634.410000000000,139,109,263.510000000000,659.760000000000,128,32.9750523600000,3.11224707700000;356,109,263.510000000000,659.760000000000,128,111,268.480000000000,699.540000000000,106,56.4796909800000,4.74824910200000;357,111,268.480000000000,699.540000000000,106,114,267.490000000000,720.920000000000,97,27.8586549200000,3.20155712500000;358,114,267.490000000000,720.920000000000,97,115,257.540000000000,739.810000000000,85,30.1254892800000,2.99708267100000;359,242,143.690000000000,80.5400000000000,197,126,116.340000000000,106.890000000000,150,75.5811389800000,3.59176217300000;360,20,216.770000000000,319.690000000000,187,243,142.190000000000,247.100000000000,163,164.710651500000,2.71574855300000;361,243,142.190000000000,247.100000000000,163,141,117.830000000000,239.150000000000,151,36.6223638300000,3.26384379900000]];
c0=0.6;%need to check the radii of path212 which is less that 1.3(set c0=0 but not c0=1.3)
a=vasculature;
b=[a(:,2) a(:,6) a(:,10) a(:,11)-c0];
Len=b(:,3);
% Rad=b(:,4);
nn=size(b);     n1=nn(1);
n2=max([b(:,1);b(:,2)]);

for ss=1:size(sim_radii,1)
    sim_Rad{ss}=sim_radii(ss,:)-c0;
end

Re=cell(1,length(t));
flow=cell(1,length(t));
pressure=cell(1,length(t));
fp=cell(1,length(t));

tic
for ss=1:length(t)
    b(:,4)=sim_Rad{ss};
    Rad=b(:,4);
    
kk1=1;
kk2=1;
for i=1:length(or_in)
    if (sum((b(:,2)==b(or_in(i),2))+(b(:,1)==b(or_in(i),2)))==1)&&(sum((b(:,1)==b(or_in(i),1))+(b(:,1)==b(or_in(i),1)))==1)
        fprintf('warning:%s\n','isolated segment')
        exit
    end
    if sum((b(:,2)==b(or_in(i),2))+(b(:,1)==b(or_in(i),2)))==1
        in(kk1)=b(or_in(i),2);
    else
        in(kk1)=b(or_in(i),1);
    end
    kk1=kk1+1;
end

for i=1:length(or_out)
    if (sum((b(:,2)==b(or_out(i),2))+(b(:,1)==b(or_out(i),2)))==1)&&(sum((b(:,1)==b(or_out(i),1))+(b(:,1)==b(or_out(i),1)))==1)
        fprintf('warning:%s\n','isolated segment')
        exit
    end
    if sum((b(:,2)==b(or_out(i),2))+(b(:,1)==b(or_out(i),2)))==1
        out(kk2)=b(or_out(i),2);
    else
        out(kk2)=b(or_out(i),1);
    end
    kk2=kk2+1;
end
io=[in out];

P_in=[100,100,40,20];
%in_flow condition
nin=length(in);
for i=1:nin
    AA(n1+in(i)+1,n1+in(i)+1)=1;
%     bb(n1+in(i)+1)=P_in;
    bb(n1+in(i)+1)=P_in(i);
end
%out_flow condition
nout=length(out);
for i=1:nout
    if sum((b(:,2)==b(or_out(i),2))+(b(:,1)==b(or_out(i),2)))==1 %¶ÈÊýÎª1;
        AA(n1+out(i)+1,or_out(i))=1;
        bb(n1+out(i)+1)=sstress0*Rad(or_out(i))^3;
    else
        AA(n1+out(i)+1,or_out(i))=1;
        bb(n1+out(i)+1)=-sstress0*Rad(or_out(i))^3;
    end
end

%flow condition at junctions
nio=length(io);
kk=0;
for i=0:n2
    if sum(io==i)==0
        kk=kk+1;
        jun(kk)=i;
    end
end

for i=1:(n2-nio+1)
    for j=1:n1
        if b(j,1)==jun(i)
            AA(n1+jun(i)+1,j)=-1;
        elseif b(j,2)==jun(i)
            AA(n1+jun(i)+1,j)=1;
        end
    end
    bb(n1+jun(i)+1)=0;
end
%adaptation
Len=b(:,3);

Re=b(:,3)./Rad.^4;
    for i=1:n1
        AA(i,i)=Re(i);
        AA(i,n1+b(i,1)+1)=-1;
        AA(i,n1+b(i,2)+1)=1;
        bb(i)=0;
    end
    fp{ss}=AA\(bb');
    flow{ss}=fp{ss}(1:n1);
    pressure{ss}=fp{ss}(n1+1:n1+n2);
    ss
end

flow_eachvessel=[];% blood flow dynamics of each vessel segment;
for i=1:vesselnum
    for j=1:length(t)
    flow_eachvessel(j,i)=flow{j}(i);
    end
end
toc
